<script>
    document.addEventListener('DOMContentLoaded', function() {
    // Initialize modal
    requestsModal = new bootstrap.Modal(document.getElementById('requestsModal'));
    
    // Load notification count immediately
    updateNotificationCount();
    
    // Load charts
    loadCharts();

    // Set up periodic refresh (every 5 minutes)
    setInterval(updateNotificationCount, 300000);

    // Notification click handler
    document.querySelector('.notification').addEventListener('click', async function() {
        await showRequestsModal();
    });
});

async function updateNotificationCount() {
    try {
        const response = await fetch('/visitor/api/get_pending_requests');
        if (!response.ok) throw new Error('Failed to fetch notification count');
        
        const data = await response.json();
        if (data.success) {
            updateNotificationBadge(data.count);
        }
    } catch (error) {
        console.error('Error updating notification count:', error);
        // Keep the badge hidden if there's an error
        updateNotificationBadge(0);
    }
}

function updateNotificationBadge(count) {
    const badge = document.querySelector('.notification-badge');
    if (count > 0) {
        badge.textContent = count;
        badge.style.display = 'flex';
    } else {
        badge.style.display = 'none';
    }
}
</script>